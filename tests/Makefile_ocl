CXX ?= g++

.SUFFIXES: .o .cpp .ptx .cu

SAPPOROPATH=..
SAPLIB2 = sapporo
SAPLIB = lib$(SAPLIB2).a

CUDA_TK  ?= /usr/local/cuda
#CUDA_TK  = /opt/AMDAPP/

OFLAGS = -g -O3 -Wall -Wextra -Wstrict-aliasing=2 -fopenmp
CXXFLAGS +=  -fPIC -fopenmp $(OFLAGS) -D_OCL_

LDFLAGS += -lOpenCL -fopenmp  

INCLUDEPATH = $(SAPPOROPATH)/include
CXXFLAGS  += -I$(INCLUDEPATH) -I./ -I $(SAPPOROPATH)/src -I$(CUDA_TK)/include


SRCPATH = src
SRC = test_gravity_block.cpp  test_gravity_block_6th.cpp test_performance_rangeN.cpp test_performance_blockStep.cpp test_performance_rangeN_6th.cpp test_gravity_block_g5.cpp test_performance_rangeN_g5.cpp test_integrator.cpp
OBJ = $(SRC:%.cpp=%_ocl.o)

PROG = test_gravity_block_ocl test_gravity_block_6th_ocl test_performance_rangeN_ocl test_performance_blockStep_ocl test_performance_rangeN_6th_ocl test_gravity_block_g5_ocl test_performance_rangeN_g5_ocl test_integrator_ocl

all: $(OBJ) $(PROG) kernels

kernels:
	rm -f OpenCL && ln -s $(SAPPOROPATH)/OpenCL OpenCL

test_gravity_block_ocl : test_gravity_block_ocl.o
	$(CXX) $(LDFLAGS) $^ -o $@ -L $(SAPPOROPATH) -l$(SAPLIB2) $(LDFLAGS)

test_gravity_block_g5_ocl: test_gravity_block_g5_ocl.o
	$(CXX) $(LDFLAGS) $^ -o $@ -L $(SAPPOROPATH) -l$(SAPLIB2) $(LDFLAGS)

test_gravity_block_6th_ocl : test_gravity_block_6th_ocl.o
	$(CXX) $(LDFLAGS) $^ -o $@ -L $(SAPPOROPATH) -l$(SAPLIB2)  $(LDFLAGS)   

test_performance_rangeN_ocl : test_performance_rangeN_ocl.o
	$(CXX) $(LDFLAGS) $^ -o $@ -L $(SAPPOROPATH) -l$(SAPLIB2)  $(LDFLAGS) 

test_performance_blockStep_ocl : test_performance_blockStep_ocl.o
	$(CXX) $(LDFLAGS) $^ -o $@ -L $(SAPPOROPATH) -l$(SAPLIB2)  $(LDFLAGS)

test_performance_rangeN_6th_ocl : test_performance_rangeN_6th_ocl.o
	$(CXX) $(LDFLAGS) $^ -o $@ -L $(SAPPOROPATH) -l$(SAPLIB2) $(LDFLAGS) 

test_performance_rangeN_g5_ocl : test_performance_rangeN_g5_ocl.o
	$(CXX) $(LDFLAGS) $^ -o $@ -L $(SAPPOROPATH) -l$(SAPLIB2) $(LDFLAGS) 

test_integrator_ocl : test_integrator_ocl.o
	$(CXX) $(LDFLAGS) $^ -o $@ -L $(SAPPOROPATH) -l$(SAPLIB2) $(LDFLAGS) 

%_ocl.o: $(SRCPATH)/%.cpp
	$(CXX) $(CXXFLAGS) -c $< -o $@


clean:
	/bin/rm -rf *.o *.ptx *.a $(PROG)


$(OBJ): $(SAPPOROPATH)/$(SAPLIB)








